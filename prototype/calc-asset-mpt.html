<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>MPT Portfolio Optimizer</title>
  <link rel="stylesheet" href="styles.css">
  <script>if (localStorage.getItem('darkMode') === 'true') { document.documentElement.classList.add('dark-mode-loading'); }</script>
  <script src="device-detection.js"></script>
</head>
<body>
  <script>if (localStorage.getItem('darkMode') === 'true') { document.body.classList.add('dark-mode'); }
    if (localStorage.getItem('compactMode') === 'true') { document.body.classList.add('compact-mode'); }</script>
  <div class="app">
    <!-- sidebar removed — shared-ui provides navigation (keeps layout simpler). -->
    <header class="app__header">
      <a class="link-button" href="calc-asset.html">← Back to ASSET</a>
      <span>MPT Optimizer</span>
      <span></span>
    </header>
    <main class="app__content">
      <section class="card">
        <h2>Modern Portfolio Theory Optimizer</h2>
        <p>Find optimal portfolio weights based on expected returns and risk tolerance.</p>
        
        <form id="mptForm" style="margin-top: 20px;">
          <div style="margin-bottom: 16px; padding: 16px; background: var(--bg-muted); border-radius: 8px;">
            <h3 style="margin-top: 0;">Asset 1 (e.g., US Stocks)</h3>
            <div style="display: grid; gap: 10px;">
              <div>
                <label style="display: block; font-size: 0.9rem; margin-bottom: 4px;">Expected Return (%)</label>
                <input type="number" id="return1" step="0.1" placeholder="10" style="width: 100%; padding: 10px; border: 2px solid var(--border); border-radius: 6px; background: var(--bg-card); color: var(--text);">
              </div>
              <div>
                <label style="display: block; font-size: 0.9rem; margin-bottom: 4px;">Volatility (Std Dev %)</label>
                <input type="number" id="vol1" step="0.1" placeholder="18" style="width: 100%; padding: 10px; border: 2px solid var(--border); border-radius: 6px; background: var(--bg-card); color: var(--text);">
              </div>
            </div>
          </div>

          <div style="margin-bottom: 16px; padding: 16px; background: var(--bg-muted); border-radius: 8px;">
            <h3 style="margin-top: 0;">Asset 2 (e.g., Bonds)</h3>
            <div style="display: grid; gap: 10px;">
              <div>
                <label style="display: block; font-size: 0.9rem; margin-bottom: 4px;">Expected Return (%)</label>
                <input type="number" id="return2" step="0.1" placeholder="5" style="width: 100%; padding: 10px; border: 2px solid var(--border); border-radius: 6px; background: var(--bg-card); color: var(--text);">
              </div>
              <div>
                <label style="display: block; font-size: 0.9rem; margin-bottom: 4px;">Volatility (Std Dev %)</label>
                <input type="number" id="vol2" step="0.1" placeholder="6" style="width: 100%; padding: 10px; border: 2px solid var(--border); border-radius: 6px; background: var(--bg-card); color: var(--text);">
              </div>
            </div>
          </div>

          <div style="margin-bottom: 16px;">
            <label style="display: block; font-weight: 600; margin-bottom: 6px;">Correlation (-1 to 1)</label>
            <input type="number" id="correlation" step="0.01" min="-1" max="1" value="0.3" style="width: 100%; padding: 12px; border: 2px solid var(--border); border-radius: 8px; font-size: 1rem; background: var(--bg-card); color: var(--text);">
            <small style="color: var(--text-muted);">How assets move together: -1 (opposite), 0 (independent), 1 (together)</small>
          </div>

          <div style="margin-bottom: 16px;">
            <label style="display: block; font-weight: 600; margin-bottom: 6px;">Risk Tolerance</label>
            <select id="riskTolerance" style="width: 100%; padding: 12px; border: 2px solid var(--border); border-radius: 8px; font-size: 1rem; background: var(--bg-card); color: var(--text);">
              <option value="conservative">Conservative (minimize risk)</option>
              <option value="moderate" selected>Moderate (balanced)</option>
              <option value="aggressive">Aggressive (maximize return)</option>
            </select>
          </div>
          
          <button type="submit" class="btn btn--primary" style="width: 100%; padding: 14px; font-size: 1.1rem;">Optimize Portfolio</button>
        </form>
        
        <div id="result" style="display: none; margin-top: 24px; padding: 20px; background: var(--bg-muted); border-radius: 12px; border: 2px solid var(--accent);">
          <h3 style="margin-bottom: 16px; color: var(--accent);">Optimal Portfolio</h3>
          <div style="display: grid; gap: 12px;">
            <div style="padding: 16px; background: var(--bg-card); border-radius: 8px;">
              <h4 style="margin: 0 0 12px 0;">Asset Allocation</h4>
              <div style="display: grid; gap: 8px;">
                <div style="display: flex; justify-content: space-between; padding: 8px; background: var(--bg-muted); border-radius: 4px;">
                  <span style="font-weight: 600;">Asset 1:</span>
                  <span id="weight1" style="font-weight: bold; color: var(--accent);"></span>
                </div>
                <div style="display: flex; justify-content: space-between; padding: 8px; background: var(--bg-muted); border-radius: 4px;">
                  <span style="font-weight: 600;">Asset 2:</span>
                  <span id="weight2" style="font-weight: bold; color: var(--accent);"></span>
                </div>
              </div>
            </div>
            <div style="padding: 12px; background: var(--bg-card); border-radius: 8px;">
              <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                <span style="font-weight: 600;">Expected Return:</span>
                <span id="portfolioReturn" style="color: #10b981; font-weight: bold;"></span>
              </div>
              <div style="display: flex; justify-content: space-between;">
                <span style="font-weight: 600;">Portfolio Risk:</span>
                <span id="portfolioRisk" style="color: #f59e0b; font-weight: bold;"></span>
              </div>
            </div>
            <div style="padding: 12px; background: var(--bg-card); border-radius: 8px;">
              <div style="display: flex; justify-content: space-between;">
                <span style="font-weight: 600;">Sharpe Ratio:</span>
                <span id="sharpeRatio" style="font-size: 1.2rem; font-weight: bold; color: var(--accent);"></span>
              </div>
              <small style="color: var(--text-muted);">Higher is better (return per unit of risk)</small>
            </div>
          </div>
        </div>
      </section>
    </main>
    <nav class="tabbar" aria-label="Primary navigation">
      <a class="tabbar__btn" href="index.html">
        <svg class="icon icon--tab" viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-home"></use></svg>
        <span>Main</span>
      </a>
      <a class="tabbar__btn" href="simulator.html">
        <svg class="icon icon--tab" viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-sim"></use></svg>
        <span>Sim/AI</span>
      </a>
      <a class="tabbar__btn" href="lessons.html">
        <svg class="icon icon--tab" viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-lessons"></use></svg>
        <span>Lessons</span>
      </a>
      <a class="tabbar__btn tabbar__btn--active" href="calculators.html">
        <svg class="icon icon--tab" viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-calc"></use></svg>
        <span>Calc</span>
      </a>
      <a class="tabbar__btn" href="profile.html">
        <svg class="icon icon--tab" viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-profile"></use></svg>
        <span>Profile</span>
      </a>
    </nav>
  </div>
  <script>
    document.getElementById('mptForm').addEventListener('submit', function(e) {
      e.preventDefault();
      const r1 = parseFloat(document.getElementById('return1').value) / 100;
      const r2 = parseFloat(document.getElementById('return2').value) / 100;
      const v1 = parseFloat(document.getElementById('vol1').value) / 100;
      const v2 = parseFloat(document.getElementById('vol2').value) / 100;
      const corr = parseFloat(document.getElementById('correlation').value);
      const riskTol = document.getElementById('riskTolerance').value;
      
      if (isNaN(r1) || isNaN(r2) || isNaN(v1) || isNaN(v2)) {
        alert('Please fill in all fields');
        return;
      }
      
      let w1, w2;
      if (riskTol === 'conservative') {
        const variance1 = v1 * v1;
        const variance2 = v2 * v2;
        const covariance = corr * v1 * v2;
        w1 = (variance2 - covariance) / (variance1 + variance2 - 2 * covariance);
        w1 = Math.max(0, Math.min(1, w1));
      } else if (riskTol === 'aggressive') {
        w1 = r1 > r2 ? 0.8 : 0.2;
      } else {
        const riskFreeRate = 0.02;
        const sharpe1 = (r1 - riskFreeRate) / v1;
        const sharpe2 = (r2 - riskFreeRate) / v2;
        const totalSharpe = sharpe1 + sharpe2;
        w1 = sharpe1 / totalSharpe;
      }
      
      w2 = 1 - w1;
      
      const portfolioReturn = w1 * r1 + w2 * r2;
      const portfolioVariance = (w1 * w1 * v1 * v1) + (w2 * w2 * v2 * v2) + (2 * w1 * w2 * corr * v1 * v2);
      const portfolioRisk = Math.sqrt(portfolioVariance);
      const sharpeRatio = (portfolioReturn - 0.02) / portfolioRisk;
      
      document.getElementById('weight1').textContent = (w1 * 100).toFixed(1) + '%';
      document.getElementById('weight2').textContent = (w2 * 100).toFixed(1) + '%';
      document.getElementById('portfolioReturn').textContent = (portfolioReturn * 100).toFixed(2) + '%';
      document.getElementById('portfolioRisk').textContent = (portfolioRisk * 100).toFixed(2) + '%';
      document.getElementById('sharpeRatio').textContent = sharpeRatio.toFixed(2);
      
      document.getElementById('result').style.display = 'block';
      document.getElementById('result').scrollIntoView({ behavior: 'smooth', block: 'nearest' });
    });
  </script>
</body>
</html>

