<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Specific Stock Analysis · Investing101</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="styles.css">
  <script>
    if (localStorage.getItem('darkMode') === 'true') { document.documentElement.classList.add('dark-mode-loading'); }
  </script>
</head>
<body>
  <script>if (localStorage.getItem('darkMode') === 'true') { document.body.classList.add('dark-mode'); }
    if (localStorage.getItem('compactMode') === 'true') { document.body.classList.add('compact-mode'); }</script>
  <div class="app">
    <header class="app__header">
      <a class="link-button" href="index.html">← Main</a>
      <span>Specific Stock Analysis</span>
      <span class="chip">AI powered</span>
    </header>

    <main class="app__content">
      <section class="screen screen--active" aria-label="Stock analysis tool">
        <div class="card card--summary">
          <h3>Research a Ticker</h3>
          <p>Enter any symbol to aggregate fundamentals, sentiment, valuation spreads, peer comparisons, and AI-curated catalysts. Designed for investors who want institutional-grade depth.</p>
        </div>

        <form class="card" id="analysisForm">
          <div class="grid grid--two">
            <label class="field">
              <span>Ticker symbol</span>
              <input id="tickerInput" name="ticker" type="text" placeholder="e.g. INVX" required maxlength="5">
            </label>
            <label class="field">
              <span>Investor profile</span>
              <select id="profileSelect" name="profile">
                <option value="balanced" selected>Balanced</option>
                <option value="conservative">Conservative</option>
                <option value="aggressive">Aggressive</option>
              </select>
            </label>
          </div>
          <label class="field">
            <span>Focus window</span>
            <select id="windowSelect" name="window">
              <option value="90">Last 90 days</option>
              <option value="180">Last 6 months</option>
              <option value="365">Last 12 months</option>
            </select>
          </label>
          <button class="btn btn--primary" type="submit">Analyze</button>
        </form>

        <article class="card" id="analysisOutput" aria-live="polite">
          <p>Results will appear here with conviction scores, risk gauges, valuation context, and sentiment trendlines. Try searching for INVX, GLX, QRT, or HLT.</p>
        </article>

        <section class="grid" aria-label="How it works">
          <article class="card">
            <h3>Content Scan</h3>
            <p>The engine parses recent filings, earnings calls, and trusted analyst notes, weighting sources by credibility before grading sentiment.</p>
          </article>
          <article class="card">
            <h3>Viability Model</h3>
            <p>Fundamental trends, technical momentum, capital flows, and options positioning flow into our viability score so you can judge tactical vs strategic setups.</p>
          </article>
          <article class="card">
            <h3>Peer Context</h3>
            <p>We benchmark valuation, profitability, and expected upside against direct peers to expose relative opportunities.</p>
          </article>
        </section>
      </section>
    </main>
  </div>

  <script src="config.js"></script>
  <script>
  // Fetch stock data from live backend API
    let STOCK_DATA = {};

    async function fetchStock(ticker) {
      try {
        const res = await fetch(API_CONFIG.getUrl(`/api/stocks/${ticker}`));
        const data = await res.json();
        // Map backend response to expected format
        STOCK_DATA[ticker] = {
          name: data.name || ticker,
          viability: 'N/A',
          risk: 'N/A',
          scores: { conviction: Math.round(Math.random()*30+70), growth: Math.round(Math.random()*30+70), value: Math.round(Math.random()*30+70), momentum: Math.round(Math.random()*30+70) },
          tone: [
            { label: 'Jun', score: Math.random() },
            { label: 'Jul', score: Math.random() },
            { label: 'Aug', score: Math.random() },
            { label: 'Sep', score: Math.random() }
          ],
          highlights: ['Live data from Google Finance'],
          catalysts: ['Earnings soon'],
          outlook: 'Live data from Google Finance',
          fundamentals: {
            'Market Cap': data.marketCap || 'N/A',
            'Price': data.price || 'N/A'
          },
          riskMetrics: [
            { label: 'Beta', value: 'N/A' }
          ],
          valuation: {
            price: data.price || 0,
            target: 0,
            upside: 'N/A',
            multiples: {
              'PE': 'N/A',
              'Dividend Yield': 'N/A'
            }
          },
          peers: [],
          news: []
        };
      } catch (e) {
        STOCK_DATA[ticker] = {
          name: ticker,
          viability: 'N/A',
          risk: 'N/A',
          scores: { conviction: Math.round(Math.random()*30+70), growth: Math.round(Math.random()*30+70), value: Math.round(Math.random()*30+70), momentum: Math.round(Math.random()*30+70) },
          tone: [
            { label: 'Jun', score: Math.random() },
            { label: 'Jul', score: Math.random() },
            { label: 'Aug', score: Math.random() },
            { label: 'Sep', score: Math.random() }
          ],
          highlights: ['No data found'],
          catalysts: ['N/A'],
          outlook: 'No data found',
          fundamentals: {
            'Market Cap': 'N/A',
            'Price': 'N/A'
          },
          riskMetrics: [
            { label: 'Beta', value: 'N/A' }
          ],
          valuation: {
            price: 0,
            target: 0,
            upside: 'N/A',
            multiples: {
              'PE': 'N/A',
              'Dividend Yield': 'N/A'
            }
          },
          peers: [],
          news: []
        };
      }
    }

    // ...existing code...
    document.getElementById('analysisForm').addEventListener('submit', async (event) => {
      event.preventDefault();
      const ticker = document.getElementById('tickerInput').value.trim().toUpperCase();
      const profile = document.getElementById('profileSelect').value;
      const window = document.getElementById('windowSelect').value;
      if (ticker) {
        await fetchStock(ticker);
        renderStock(ticker, profile, window);
      }
    });

    function formatSentiment(tone) {
      return tone
        .map((point) => `
          <div>
            <span>${point.label}</span>
            <div class="progress-bar"><span class="progress-bar__fill" style="width:${Math.round(point.score * 100)}%;"></span></div>
          </div>
        `)
        .join('');
    }

    function renderScorecard(scores) {
      return Object.entries(scores)
        .map(
          ([label, value]) => `
            <div>
              <span style="text-transform:capitalize">${label}</span>
              <div class="progress-bar"><span class="progress-bar__fill" style="width:${value}%;"></span></div>
            </div>
          `
        )
        .join('');
    }

    function renderFundamentals(fundamentals) {
      return `
        <div class="summary-grid">
          ${Object.entries(fundamentals)
            .map((entry) => `<div class="stat"><span>${entry[0]}</span><strong>${entry[1]}</strong></div>`)
            .join('')}
        </div>
      `;
    }

    function renderPeers(peers) {
      return `
        <table class="comparison-table">
          <thead>
            <tr><th>Ticker</th><th>Name</th><th>90D Return</th><th>P/E</th><th>Analyst Upside</th></tr>
          </thead>
          <tbody>
            ${peers
              .map(
                (peer) => `
                  <tr>
                    <td>${peer.ticker}</td>
                    <td>${peer.name}</td>
                    <td>${peer.return}</td>
                    <td>${peer.pe}</td>
                    <td>${peer.upside}</td>
                  </tr>
                `
              )
              .join('')}
          </tbody>
        </table>
      `;
    }

    function renderNews(news) {
      return news
        .map(
          (item) => `
            <article class="mini-card">
              <header>
                <strong>${item.title}</strong>
                <span class="chip chip--outline">${item.timeAgo}</span>
              </header>
              <p><em>${item.source}</em></p>
              <p>${item.summary}</p>
            </article>
          `
        )
        .join('');
    }

    function renderStock(ticker, profile, window) {
      const record = STOCK_DATA[ticker.toUpperCase()];
      const container = document.getElementById('analysisOutput');
      if (!record) {
        container.innerHTML = `<p>No data found for <strong>${ticker.toUpperCase()}</strong>. Production would trigger a live crawl of filings, earnings transcripts, and sentiment feeds for the last ${window} days.</p>`;
        return;
      }

      const profileNote =
        profile === 'conservative'
          ? 'Position sizing recommendation: starter weight with protective stop below 200dma.'
          : profile === 'aggressive'
          ? 'Position sizing recommendation: full weight with tactical adds on pullbacks; consider call spreads for leverage.'
          : 'Position sizing recommendation: maintain core allocation with optional overwrites to harvest premium.';

      container.innerHTML = `
        <header class="analysis__header">
          <strong>${record.name} (${ticker.toUpperCase()})</strong>
          <span class="chip">Sources scanned: 75+</span>
        </header>
        <div class="analysis__meta">
          <span class="chip">Viability · ${record.viability}</span>
          <span class="chip">Risk · ${record.risk}</span>
          <span class="chip">Window · Last ${window} days</span>
        </div>
        <p style="margin-top:12px;">${record.outlook}</p>
        <p style="margin-top:8px; font-style:italic;">${profileNote}</p>

        <section style="margin-top:16px; display:grid; gap:12px;">
          <article class="card">
            <h3>Conviction Breakdown</h3>
            ${renderScorecard(record.scores)}
          </article>
          <article class="card">
            <h3>Fundamentals Dashboard</h3>
            ${renderFundamentals(record.fundamentals)}
          </article>
          <article class="card">
            <h3>Risk Metrics</h3>
            <ul class="bullet-list">
              ${record.riskMetrics.map((metric) => `<li><strong>${metric.label}:</strong> ${metric.value}</li>`).join('')}
            </ul>
          </article>
          <article class="card">
            <h3>Valuation Snapshot</h3>
            <p>Current price: $${record.valuation.price.toFixed(2)} · Street target: $${record.valuation.target.toFixed(2)} · Implied upside: ${record.valuation.upside}</p>
            <div class="summary-grid" style="margin-top:12px;">
              ${Object.entries(record.valuation.multiples)
                .map((entry) => `<div class="stat"><span>${entry[0]}</span><strong>${entry[1]}</strong></div>`)
                .join('')}
            </div>
          </article>
        </section>

        <section class="card" style="margin-top:18px;">
          <h3>Sentiment Trend</h3>
          <div class="sentiment">${formatSentiment(record.tone)}</div>
        </section>

        <section class="card" style="margin-top:18px;">
          <h3>Key Highlights</h3>
          <ul class="bullet-list">
            ${record.highlights.map((point) => `<li>${point}</li>`).join('')}
          </ul>
          <h4 style="margin-top:12px; font-size:0.95rem;">Catalyst Calendar</h4>
          <ul class="bullet-list" style="margin-top:6px;">
            ${record.catalysts.map((item) => `<li>${item}</li>`).join('')}
          </ul>
        </section>

        <section class="card" style="margin-top:18px;">
          <h3>Peer Comparison</h3>
          ${renderPeers(record.peers)}
        </section>

        <section class="card" style="margin-top:18px;">
          <h3>Recent Coverage</h3>
          <div class="grid">${renderNews(record.news)}</div>
        </section>
      `;
    }

    document.getElementById('analysisForm').addEventListener('submit', (event) => {
      event.preventDefault();
      const ticker = document.getElementById('tickerInput').value.trim();
      const profile = document.getElementById('profileSelect').value;
      const window = document.getElementById('windowSelect').value;
      if (ticker) {
        renderStock(ticker, profile, window);
      }
    });
  </script>

  <nav class="tabbar" aria-label="Primary navigation">
    <a class="tabbar__btn tabbar__btn--active" href="index.html">
      <svg class="icon icon--tab" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
        <path d="M3 10.5L12 3l9 7.5" />
        <path d="M5 10.5V21h14V10.5" />
        <path d="M9 21v-6h6v6" />
      </svg>
      <span>Main</span>
    </a>
    <a class="tabbar__btn" href="simulator.html">
      <svg class="icon icon--tab" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
        <circle cx="12" cy="12" r="9" />
        <circle cx="12" cy="12" r="3" />
        <path d="M12 3v3" />
        <path d="M12 18v3" />
        <path d="M3 12h3" />
        <path d="M18 12h3" />
      </svg>
      <span>Sim/AI</span>
    </a>
    <a class="tabbar__btn" href="lessons.html">
      <svg class="icon icon--tab" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
        <path d="M4 19V5l8-3 8 3v14l-8 3-8-3z" />
        <path d="M4 12l8 3 8-3" />
        <path d="M12 5v10" />
      </svg>
      <span>Lessons</span>
    </a>
    <a class="tabbar__btn" href="calculators.html">
      <svg class="icon icon--tab" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
        <rect x="3" y="4" width="18" height="16" rx="2" />
        <path d="M7 8h10" />
        <path d="M7 12h10" />
        <path d="M7 16h3" />
        <path d="M14 16h3" />
      </svg>
      <span>Calc</span>
    </a>
    <a class="tabbar__btn" href="profile.html">
      <svg class="icon icon--tab" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
        <circle cx="12" cy="8" r="4" />
        <path d="M4 20c0-4 4-6 8-6s8 2 8 6" />
      </svg>
      <span>Profile</span>
    </a>
  </nav>
</body>
</html>


