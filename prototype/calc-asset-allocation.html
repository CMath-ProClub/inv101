<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Asset Allocation Rebalancer</title>
  <link rel="stylesheet" href="styles.css">
  <script>if (localStorage.getItem('darkMode') === 'true') { document.documentElement.classList.add('dark-mode-loading'); }</script>
  <script src="device-detection.js"></script>
</head>
<body>
  <script>if (localStorage.getItem('darkMode') === 'true') { document.body.classList.add('dark-mode'); }
    if (localStorage.getItem('compactMode') === 'true') { document.body.classList.add('compact-mode'); }</script>
  <div class="app">
    <!-- Desktop Sidebar Navigation (visible on desktop only) -->
    <!-- sidebar removed ‚Äî shared-ui provides navigation (keeps layout simpler). -->
    <header class="app__header">
      <a class="link-button" href="calc-asset.html">‚Üê Back to ASSET</a>
      <span>Asset Allocation</span>
      <span></span>
    </header>
    <main class="app__content">
      <section class="card">
        <h2>Asset Allocation Rebalancer</h2>
        <p>Calculate required trades to rebalance your portfolio to target allocations.</p>
        
        <form id="rebalanceForm" style="margin-top: 20px;">
          <div style="margin-bottom: 20px; padding: 16px; background: var(--bg-muted); border-radius: 8px;">
            <h3 style="margin-top: 0;">Stocks</h3>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px;">
              <div>
                <label style="display: block; font-size: 0.9rem; margin-bottom: 4px;">Current Value ($)</label>
                <input type="number" id="stocksCurrent" step="0.01" min="0" placeholder="40000" style="width: 100%; padding: 10px; border: 2px solid var(--border); border-radius: 6px; background: var(--bg-card); color: var(--text);">
              </div>
              <div>
                <label style="display: block; font-size: 0.9rem; margin-bottom: 4px;">Target %</label>
                <input type="number" id="stocksTarget" step="0.1" min="0" max="100" placeholder="60" style="width: 100%; padding: 10px; border: 2px solid var(--border); border-radius: 6px; background: var(--bg-card); color: var(--text);">
              </div>
            </div>
          </div>

          <div style="margin-bottom: 20px; padding: 16px; background: var(--bg-muted); border-radius: 8px;">
            <h3 style="margin-top: 0;">Bonds</h3>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px;">
              <div>
                <label style="display: block; font-size: 0.9rem; margin-bottom: 4px;">Current Value ($)</label>
                <input type="number" id="bondsCurrent" step="0.01" min="0" placeholder="30000" style="width: 100%; padding: 10px; border: 2px solid var(--border); border-radius: 6px; background: var(--bg-card); color: var(--text);">
              </div>
              <div>
                <label style="display: block; font-size: 0.9rem; margin-bottom: 4px;">Target %</label>
                <input type="number" id="bondsTarget" step="0.1" min="0" max="100" placeholder="30" style="width: 100%; padding: 10px; border: 2px solid var(--border); border-radius: 6px; background: var(--bg-card); color: var(--text);">
              </div>
            </div>
          </div>

          <div style="margin-bottom: 20px; padding: 16px; background: var(--bg-muted); border-radius: 8px;">
            <h3 style="margin-top: 0;">Real Estate</h3>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px;">
              <div>
                <label style="display: block; font-size: 0.9rem; margin-bottom: 4px;">Current Value ($)</label>
                <input type="number" id="reCurrent" step="0.01" min="0" placeholder="20000" style="width: 100%; padding: 10px; border: 2px solid var(--border); border-radius: 6px; background: var(--bg-card); color: var(--text);">
              </div>
              <div>
                <label style="display: block; font-size: 0.9rem; margin-bottom: 4px;">Target %</label>
                <input type="number" id="reTarget" step="0.1" min="0" max="100" placeholder="5" style="width: 100%; padding: 10px; border: 2px solid var(--border); border-radius: 6px; background: var(--bg-card); color: var(--text);">
              </div>
            </div>
          </div>

          <div style="margin-bottom: 20px; padding: 16px; background: var(--bg-muted); border-radius: 8px;">
            <h3 style="margin-top: 0;">Cash</h3>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px;">
              <div>
                <label style="display: block; font-size: 0.9rem; margin-bottom: 4px;">Current Value ($)</label>
                <input type="number" id="cashCurrent" step="0.01" min="0" placeholder="10000" style="width: 100%; padding: 10px; border: 2px solid var(--border); border-radius: 6px; background: var(--bg-card); color: var(--text);">
              </div>
              <div>
                <label style="display: block; font-size: 0.9rem; margin-bottom: 4px;">Target %</label>
                <input type="number" id="cashTarget" step="0.1" min="0" max="100" placeholder="5" style="width: 100%; padding: 10px; border: 2px solid var(--border); border-radius: 6px; background: var(--bg-card); color: var(--text);">
              </div>
            </div>
          </div>
          
          <button type="submit" class="btn btn--primary" style="width: 100%; padding: 14px; font-size: 1.1rem;">Calculate Rebalancing</button>
        </form>
        
        <div id="result" style="display: none; margin-top: 24px; padding: 20px; background: var(--bg-muted); border-radius: 12px; border: 2px solid var(--accent);">
          <h3 style="margin-bottom: 16px; color: var(--accent);">Rebalancing Plan</h3>
          <div style="display: grid; gap: 12px;">
            <div style="padding: 12px; background: var(--bg-card); border-radius: 8px;">
              <div style="display: flex; justify-content: space-between; margin-bottom: 4px;">
                <span style="font-weight: 600;">Total Portfolio:</span>
                <span id="totalPortfolio" style="font-weight: bold;"></span>
              </div>
            </div>
            <div id="actions" style="margin-top: 12px;"></div>
          </div>
        </div>
      </section>
    </main>
    <nav class="tabbar"><a class="tabbar__btn" href="index.html"><svg class="icon icon--tab" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 10.5L12 3l9 7.5" /><path d="M5 10.5V21h14V10.5" /><path d="M9 21v-6h6v6" /></svg><span>Main</span></a><a class="tabbar__btn" href="simulator.html"><svg class="icon icon--tab" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="9" /><circle cx="12" cy="12" r="3" /><path d="M12 3v3" /><path d="M12 18v3" /><path d="M3 12h3" /><path d="M18 12h3" /></svg><span>Sim/AI</span></a><a class="tabbar__btn" href="lessons.html"><svg class="icon icon--tab" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M4 19V5l8-3 8 3v14l-8 3-8-3z" /><path d="M4 12l8 3 8-3" /><path d="M12 5v10" /></svg><span>Lessons</span></a><a class="tabbar__btn tabbar__btn--active" href="calculators.html"><svg class="icon icon--tab" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="4" width="18" height="16" rx="2" /><path d="M7 8h10" /><path d="M7 12h10" /><path d="M7 16h4" /></svg><span>Calc</span></a><a class="tabbar__btn" href="profile.html"><svg class="icon icon--tab" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="8" r="4" /><path d="M4 20c0-4 4-6 8-6s8 2 8 6" /></svg><span>Profile</span></a></nav>
  </div>
  <script>
    document.getElementById('rebalanceForm').addEventListener('submit', function(e) {
      e.preventDefault();
      const assets = {
        stocks: { current: parseFloat(document.getElementById('stocksCurrent').value) || 0, target: parseFloat(document.getElementById('stocksTarget').value) || 0 },
        bonds: { current: parseFloat(document.getElementById('bondsCurrent').value) || 0, target: parseFloat(document.getElementById('bondsTarget').value) || 0 },
        re: { current: parseFloat(document.getElementById('reCurrent').value) || 0, target: parseFloat(document.getElementById('reTarget').value) || 0 },
        cash: { current: parseFloat(document.getElementById('cashCurrent').value) || 0, target: parseFloat(document.getElementById('cashTarget').value) || 0 }
      };
      
      const total = assets.stocks.current + assets.bonds.current + assets.re.current + assets.cash.current;
      if (total === 0) { alert('Please enter current values'); return; }
      
      const targetTotal = assets.stocks.target + assets.bonds.target + assets.re.target + assets.cash.target;
      if (Math.abs(targetTotal - 100) > 0.1) { alert('Target percentages must sum to 100%'); return; }
      
      const assetNames = { stocks: 'Stocks', bonds: 'Bonds', re: 'Real Estate', cash: 'Cash' };
      let actionsHTML = '';
      
      for (let key in assets) {
        const asset = assets[key];
        const currentPct = (asset.current / total) * 100;
        const targetValue = (asset.target / 100) * total;
        const diff = targetValue - asset.current;
        const diffPct = ((targetValue - asset.current) / total) * 100;
        
        let action = '';
        let color = '';
        if (Math.abs(diff) < total * 0.005) {
          action = '‚úÖ No action needed';
          color = '#10b981';
        } else if (diff > 0) {
          action = `üìà BUY $${Math.abs(diff).toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g, ',')}`;
          color = '#10b981';
        } else {
          action = `üìâ SELL $${Math.abs(diff).toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g, ',')}`;
          color = '#ef4444';
        }
        
        actionsHTML += `
          <div style="padding: 14px; background: var(--bg-card); border-radius: 8px; border-left: 4px solid ${color};">
            <div style="font-weight: 600; margin-bottom: 8px;">${assetNames[key]}</div>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px; font-size: 0.9rem; margin-bottom: 8px;">
              <div>Current: $${asset.current.toFixed(0).replace(/\B(?=(\d{3})+(?!\d))/g, ',')} (${currentPct.toFixed(1)}%)</div>
              <div>Target: $${targetValue.toFixed(0).replace(/\B(?=(\d{3})+(?!\d))/g, ',')} (${asset.target.toFixed(1)}%)</div>
            </div>
            <div style="font-weight: bold; color: ${color};">${action}</div>
          </div>
        `;
      }
      
      document.getElementById('totalPortfolio').textContent = '$' + total.toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g, ',');
      document.getElementById('actions').innerHTML = actionsHTML;
      document.getElementById('result').style.display = 'block';
      document.getElementById('result').scrollIntoView({ behavior: 'smooth', block: 'nearest' });
    });
  </script>
</body>
</html>

