<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Sign Up - Investing101</title>
	<link rel="stylesheet" href="styles.css">
	<link rel="stylesheet" href="signin.html" media="(min-width: 1px)">
</head>
<body>
	<main class="app__content" style="min-height: 100vh; display: flex; align-items: center; justify-content: center; padding: 20px;">
		<section class="card" style="max-width: 480px; width: 100%; margin: 0 auto;">
			<h2 style="text-align: center; margin-bottom: 12px;">Create Your Account</h2>
			<p style="text-align: center; color: var(--text-muted); margin-bottom: 32px;">Join Investing101 and start your journey</p>
			
			<form id="signupForm">
				<label class="field" style="margin-bottom: 16px;">
					<span>Email Address</span>
					<input type="email" name="email" placeholder="you@example.com" autocomplete="email" required>
				</label>
				<label class="field" style="margin-bottom: 16px;">
					<span>Display Name</span>
					<input type="text" name="displayName" placeholder="How should we call you?" autocomplete="name" required>
				</label>
				<label class="field" style="margin-bottom: 16px;">
					<span>Password</span>
					<input type="password" name="password" placeholder="At least 6 characters" autocomplete="new-password" required>
				</label>
				<label style="display: flex; align-items: flex-start; gap: 10px; margin-bottom: 20px; font-size: 0.9rem;">
					<input type="checkbox" name="terms" style="margin-top: 2px;" required>
					<span>I agree to the <a href="/terms.html" target="_blank">Terms of Service</a> and <a href="/privacy.html" target="_blank">Privacy Policy</a></span>
				</label>
				<button class="btn btn--primary" type="submit" style="width: 100%; margin-bottom: 12px;">Create Account</button>
				<p id="signupStatus" style="min-height: 1.2em; font-size: 0.95rem; color: var(--text-muted); text-align: center;" aria-live="polite"></p>
			</form>
			
			<div style="margin: 24px 0; text-align: center;">
				<div style="position: relative; margin-bottom: 20px;">
					<span style="background: var(--bg-card); padding: 0 12px; position: relative; z-index: 1; color: var(--text-muted); font-size: 0.9rem;">or sign up with</span>
					<div style="position: absolute; top: 50%; left: 0; right: 0; height: 1px; background: var(--border);"></div>
				</div>
				<div style="display: flex; gap: 12px; justify-content: center;">
					<button class="btn" type="button" onclick="window.location.href='/auth/google'" style="flex: 1;">
						<svg width="18" height="18" viewBox="0 0 18 18" style="margin-right: 8px;">
							<path fill="#EA4335" d="M9 7.2v3.6h5.1c-.2 1.2-.9 2.3-1.9 3l3.1 2.4c1.8-1.7 2.8-4.1 2.8-6.8 0-.7-.1-1.3-.2-1.9H9z"/>
							<path fill="#34A853" d="M4.3 10.7l-.7.5-2.5 1.9C2.8 15.9 5.7 17.7 9 17.7c2.4 0 4.4-.8 5.9-2.3l-3.1-2.4c-.8.5-1.8.8-2.8.8-2.1 0-3.8-1.4-4.4-3.2z"/>
							<path fill="#4285F4" d="M16.9 5.4l-3.1 2.4c-.4-1.1-1.2-2-2.3-2.5-.9-.4-1.8-.6-2.8-.6-3.3 0-6.2 1.8-7.7 4.5l3.2 2.4c.6-1.8 2.3-3.2 4.4-3.2 1 0 1.9.3 2.8.8.8.5 1.5 1.2 1.9 2.1l3.1-2.4z"/>
							<path fill="#FBBC05" d="M1.6 5.9l3.2 2.4c-.2.5-.3 1-.3 1.5s.1 1 .3 1.5l-3.2 2.4C.9 12.6.6 11.3.6 9.8c0-1.5.3-2.8 1-3.9z"/>
						</svg>
						Google
					</button>
					<button class="btn" type="button" onclick="window.location.href='/auth/facebook'" style="flex: 1;">
						<svg width="18" height="18" viewBox="0 0 24 24" style="margin-right: 8px;">
							<path fill="#1877F2" d="M22 12.1C22 6.6 17.5 2 12 2S2 6.6 2 12.1c0 5 3.7 9.1 8.5 9.9v-7H8v-3h2.5V9.9c0-2.5 1.5-3.9 3.7-3.9 1.1 0 2.2.2 2.2.2v2.4h-1.3c-1.3 0-1.7.8-1.7 1.6v1.9H18l-.4 3h-2.9v7c4.8-.8 8.3-4.9 8.3-9.9z"/>
						</svg>
						Facebook
					</button>
				</div>
			</div>
			
			<div style="text-align: center; margin-top: 20px;">
				<span style="color: var(--text-muted);">Already have an account?</span>
				<a href="signin.html" style="margin-left: 6px; font-weight: 600;">Sign in</a>
			</div>
		</section>
	</main>
	
	<script>
		(function () {
			const form = document.getElementById('signupForm');
			const statusEl = document.getElementById('signupStatus');
			const submitBtn = form.querySelector('button[type="submit"]');

			function setStatus(message, state) {
				if (!statusEl) return;
				statusEl.textContent = message || '';
				statusEl.style.color = state === 'error' ? '#f87171' : state === 'success' ? '#86efac' : 'var(--text-muted)';
			}

			async function checkExistingSession() {
				try {
					const response = await fetch('/api/auth/me', { credentials: 'include' });
					if (!response.ok) return;
					const payload = await response.json();
					if (payload?.success) {
						window.location.href = '/profile.html';
					}
				} catch (error) {
					console.warn('Session check failed:', error);
				}
			}

			form.addEventListener('submit', async (event) => {
				event.preventDefault();
				const formData = new FormData(form);
				const email = String(formData.get('email') || '').trim();
				const displayName = String(formData.get('displayName') || '').trim();
				const password = String(formData.get('password') || '');
				const termsAccepted = formData.get('terms') === 'on';

				if (!email || !displayName || !password) {
					setStatus('All fields are required.', 'error');
					return;
				}

				if (!termsAccepted) {
					setStatus('You must agree to the Terms of Service.', 'error');
					return;
				}

				if (password.length < 6) {
					setStatus('Password must be at least 6 characters.', 'error');
					return;
				}

				setStatus('Creating your account...', 'info');
				submitBtn.disabled = true;

				try {
					const response = await fetch('/api/auth/signup', {
						method: 'POST',
						headers: {
							'Content-Type': 'application/json'
						},
						credentials: 'include',
						body: JSON.stringify({ email, displayName, password })
					});

					const payload = await response.json().catch(() => ({}));
					if (!response.ok || !payload?.success) {
						throw new Error(payload?.error || 'Unable to create account. Please try again.');
					}

					setStatus('Account created! Redirecting...', 'success');
					setTimeout(() => {
						window.location.href = '/profile.html';
					}, 500);
				} catch (error) {
					console.error('Sign up failed:', error);
					setStatus(error.message || 'Unable to create account right now.', 'error');
					submitBtn.disabled = false;
				}
			});

			checkExistingSession();
		})();
	</script>
</body>
</html>
