<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Intrinsic Value Calculator</title>
  <link rel="stylesheet" href="styles.css">
  <script src="device-detection.js"></script>
  <script>
    (function(){
      try {
        var supported = ['light','dark','ultradark','emerald-trust','quantum-violet','copper-balance','regal-portfolio','carbon-edge'];
        var alias = { sepia: 'copper-balance' };
        var stored = localStorage.getItem('inv101_theme');
        var legacy = localStorage.getItem('darkMode') === 'true' ? 'dark' : null;
        var theme = (stored || legacy || 'light').toLowerCase();
        if (theme.indexOf('theme-') === 0) theme = theme.slice(6);
        if (alias[theme]) theme = alias[theme];
        if (supported.indexOf(theme) === -1) theme = 'light';
        var root = document.documentElement;
        var purge = ['dark-mode','theme-sepia'];
        supported.forEach(function(id){ purge.push('theme-' + id); });
        purge.forEach(function(cls){ root.classList.remove(cls); });
        root.classList.add('theme-' + theme);
      } catch (e) {}
    })();
  </script>
</head>
<body>
  <script src="global-ui.js"></script>
  <div class="app">
    <header class="app__header">
      <a class="link-button" href="calc-stock.html">‚Üê Back to STOCK</a>
      <span>Intrinsic Value (DCF)</span>
      <span></span>
    </header>
    <main class="app__content">
      <section class="card">
        <h2>Intrinsic Value Calculator (DCF)</h2>
        <p>Estimate a stock's fair value using Discounted Cash Flow analysis.</p>
        
        <form id="dcfForm" style="margin-top: 20px;">
          <div style="margin-bottom: 16px;">
            <label style="display: block; font-weight: 600; margin-bottom: 6px;">Current Free Cash Flow ($M)</label>
            <input type="number" id="fcf" step="0.01" placeholder="1000" style="width: 100%; padding: 12px; border: 2px solid var(--border); border-radius: 8px; font-size: 1rem; background: var(--bg-card); color: var(--text);">
            <small style="color: var(--text-muted);">Annual free cash flow in millions</small>
          </div>
          
          <div style="margin-bottom: 16px;">
            <label style="display: block; font-weight: 600; margin-bottom: 6px;">Growth Rate (%) - First 5 Years</label>
            <input type="number" id="growthRate" step="0.1" placeholder="15" style="width: 100%; padding: 12px; border: 2px solid var(--border); border-radius: 8px; font-size: 1rem; background: var(--bg-card); color: var(--text);">
          </div>
          
          <div style="margin-bottom: 16px;">
            <label style="display: block; font-weight: 600; margin-bottom: 6px;">Discount Rate (WACC %)</label>
            <input type="number" id="wacc" step="0.1" placeholder="10" style="width: 100%; padding: 12px; border: 2px solid var(--border); border-radius: 8px; font-size: 1rem; background: var(--bg-card); color: var(--text);">
            <small style="color: var(--text-muted);">Weighted Average Cost of Capital (typically 8-12%)</small>
          </div>
          
          <div style="margin-bottom: 16px;">
            <label style="display: block; font-weight: 600; margin-bottom: 6px;">Shares Outstanding (M)</label>
            <input type="number" id="shares" step="0.01" placeholder="100" style="width: 100%; padding: 12px; border: 2px solid var(--border); border-radius: 8px; font-size: 1rem; background: var(--bg-card); color: var(--text);">
          </div>
          
          <div style="margin-bottom: 16px;">
            <label style="display: block; font-weight: 600; margin-bottom: 6px;">Current Stock Price ($) - optional</label>
            <input type="number" id="currentPrice" step="0.01" placeholder="150" style="width: 100%; padding: 12px; border: 2px solid var(--border); border-radius: 8px; font-size: 1rem; background: var(--bg-card); color: var(--text);">
          </div>
          
          <button type="button" id="advancedToggle" style="width: 100%; padding: 10px; margin-bottom: 16px; background: var(--bg-muted); border: 2px solid var(--border); border-radius: 8px; font-weight: 600; cursor: pointer; color: var(--text);">
            ‚öôÔ∏è Show Advanced Settings
          </button>
          
          <div id="advancedSettings" style="display: none; padding: 16px; background: var(--bg-muted); border-radius: 8px; margin-bottom: 16px;">
            <h4 style="margin-top: 0; margin-bottom: 12px;">Advanced Settings</h4>
            
            <div style="margin-bottom: 12px;">
              <label style="display: block; font-weight: 600; margin-bottom: 6px;">Perpetual Growth Rate (%)</label>
              <input type="number" id="terminalGrowth" step="0.1" value="3" style="width: 100%; padding: 10px; border: 2px solid var(--border); border-radius: 8px; font-size: 0.95rem; background: var(--bg-card); color: var(--text);">
              <small style="color: var(--text-muted);">Terminal growth rate (typically 2-3%)</small>
            </div>
            
            <div style="margin-bottom: 12px;">
              <label style="display: block; font-weight: 600; margin-bottom: 6px;">Forecast Period (Years)</label>
              <input type="number" id="forecastYears" value="5" min="1" max="10" style="width: 100%; padding: 10px; border: 2px solid var(--border); border-radius: 8px; font-size: 0.95rem; background: var(--bg-card); color: var(--text);">
            </div>
            
            <div style="margin-bottom: 12px;">
              <label style="display: block; font-weight: 600; margin-bottom: 6px;">Cash & Equivalents ($M)</label>
              <input type="number" id="cash" value="0" step="0.01" style="width: 100%; padding: 10px; border: 2px solid var(--border); border-radius: 8px; font-size: 0.95rem; background: var(--bg-card); color: var(--text);">
            </div>
            
            <div style="margin-bottom: 0;">
              <label style="display: block; font-weight: 600; margin-bottom: 6px;">Total Debt ($M)</label>
              <input type="number" id="debt" value="0" step="0.01" style="width: 100%; padding: 10px; border: 2px solid var(--border); border-radius: 8px; font-size: 0.95rem; background: var(--bg-card); color: var(--text);">
            </div>
          </div>
          
          <button type="submit" class="btn btn--primary" style="width: 100%; padding: 14px; font-size: 1.1rem;">Calculate Intrinsic Value</button>
        </form>
        
        <div id="result" style="display: none; margin-top: 24px; padding: 20px; background: var(--bg-muted); border-radius: 12px; border: 2px solid var(--accent);">
          <h3 style="margin-bottom: 16px; color: var(--accent);">Results</h3>
          <div style="display: grid; gap: 12px;">
            <div style="padding: 16px; background: var(--bg-card); border-radius: 8px; border-left: 4px solid var(--accent);">
              <div style="font-size: 0.9rem; color: var(--text-muted); margin-bottom: 4px;">Intrinsic Value Per Share</div>
              <div id="intrinsicValue" style="font-size: 1.8rem; font-weight: bold; color: var(--accent);"></div>
            </div>
            <div id="comparisonSection" style="display: none;">
              <div style="display: flex; justify-content: space-between; padding: 12px; background: var(--bg-card); border-radius: 8px;">
                <span style="font-weight: 600;">Current Price:</span>
                <span id="currentPriceDisplay"></span>
              </div>
              <div style="display: flex; justify-content: space-between; padding: 12px; background: var(--bg-card); border-radius: 8px;">
                <span style="font-weight: 600;">Upside/Downside:</span>
                <span id="upside" style="font-weight: bold;"></span>
              </div>
              <div style="padding: 12px; background: var(--bg-card); border-radius: 8px;">
                <p id="recommendation" style="text-align: center; font-weight: 600; margin: 0;"></p>
              </div>
            </div>
            <div style="display: flex; justify-content: space-between; padding: 12px; background: var(--bg-card); border-radius: 8px;">
              <span style="font-weight: 600;">Enterprise Value:</span>
              <span id="enterpriseValue"></span>
            </div>
            <div style="display: flex; justify-content: space-between; padding: 12px; background: var(--bg-card); border-radius: 8px;">
              <span style="font-weight: 600;">Terminal Value:</span>
              <span id="terminalValue"></span>
            </div>
          </div>
        </div>
      </section>
    </main>
    <nav class="tabbar"><a class="tabbar__btn" href="index.html"><svg class="icon icon--tab" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 10.5L12 3l9 7.5" /><path d="M5 10.5V21h14V10.5" /><path d="M9 21v-6h6v6" /></svg><span>Main</span></a><a class="tabbar__btn" href="simulator.html"><svg class="icon icon--tab" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="9" /><circle cx="12" cy="12" r="3" /><path d="M12 3v3" /><path d="M12 18v3" /><path d="M3 12h3" /><path d="M18 12h3" /></svg><span>Sim/AI</span></a><a class="tabbar__btn" href="lessons.html"><svg class="icon icon--tab" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M4 19V5l8-3 8 3v14l-8 3-8-3z" /><path d="M4 12l8 3 8-3" /><path d="M12 5v10" /></svg><span>Lessons</span></a><a class="tabbar__btn tabbar__btn--active" href="calculators.html"><svg class="icon icon--tab" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="4" width="18" height="16" rx="2" /><path d="M7 8h10" /><path d="M7 12h10" /><path d="M7 16h4" /></svg><span>Calc</span></a><a class="tabbar__btn" href="profile.html"><svg class="icon icon--tab" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="8" r="4" /><path d="M4 20c0-4 4-6 8-6s8 2 8 6" /></svg><span>Profile</span></a></nav>
  </div>
  <script>
    document.getElementById('advancedToggle').addEventListener('click', function() {
      const advanced = document.getElementById('advancedSettings');
      if (advanced.style.display === 'none') {
        advanced.style.display = 'block';
        this.textContent = '‚öôÔ∏è Hide Advanced Settings';
      } else {
        advanced.style.display = 'none';
        this.textContent = '‚öôÔ∏è Show Advanced Settings';
      }
    });
    
    document.getElementById('dcfForm').addEventListener('submit', function(e) {
      e.preventDefault();
      const fcf = parseFloat(document.getElementById('fcf').value);
      const growthRate = parseFloat(document.getElementById('growthRate').value) / 100;
      const wacc = parseFloat(document.getElementById('wacc').value) / 100;
      const shares = parseFloat(document.getElementById('shares').value);
      const currentPrice = parseFloat(document.getElementById('currentPrice').value);
      const terminalGrowth = parseFloat(document.getElementById('terminalGrowth').value) / 100;
      const forecastYears = parseInt(document.getElementById('forecastYears').value);
      const cash = parseFloat(document.getElementById('cash').value) || 0;
      const debt = parseFloat(document.getElementById('debt').value) || 0;
      
      if (isNaN(fcf) || isNaN(growthRate) || isNaN(wacc) || isNaN(shares)) {
        alert('Please fill in all required fields');
        return;
      }
      
      let presentValueFCF = 0;
      let lastFCF = fcf;
      
      for (let year = 1; year <= forecastYears; year++) {
        lastFCF = lastFCF * (1 + growthRate);
        const discountFactor = Math.pow(1 + wacc, year);
        presentValueFCF += lastFCF / discountFactor;
      }
      
      const terminalFCF = lastFCF * (1 + terminalGrowth);
      const terminalValue = terminalFCF / (wacc - terminalGrowth);
      const presentTerminalValue = terminalValue / Math.pow(1 + wacc, forecastYears);
      
      const enterpriseValue = presentValueFCF + presentTerminalValue;
      const equityValue = enterpriseValue + cash - debt;
      const intrinsicValue = equityValue / shares;
      
      document.getElementById('intrinsicValue').textContent = '$' + intrinsicValue.toFixed(2);
      document.getElementById('enterpriseValue').textContent = '$' + enterpriseValue.toFixed(2) + 'M';
      document.getElementById('terminalValue').textContent = '$' + presentTerminalValue.toFixed(2) + 'M';
      
      if (!isNaN(currentPrice) && currentPrice > 0) {
        const upside = ((intrinsicValue - currentPrice) / currentPrice) * 100;
        document.getElementById('currentPriceDisplay').textContent = '$' + currentPrice.toFixed(2);
        document.getElementById('upside').textContent = upside.toFixed(2) + '%';
        document.getElementById('upside').style.color = upside > 0 ? '#10b981' : '#ef4444';
        
        let recommendation = '';
        let color = '';
        if (upside > 30) {
          recommendation = '‚úÖ STRONG BUY - Significantly undervalued';
          color = '#10b981';
        } else if (upside > 10) {
          recommendation = '‚úÖ BUY - Undervalued';
          color = '#10b981';
        } else if (upside > -10) {
          recommendation = 'üìä HOLD - Fairly valued';
          color = '#3b82f6';
        } else if (upside > -30) {
          recommendation = '‚ö†Ô∏è SELL - Overvalued';
          color = '#f59e0b';
        } else {
          recommendation = '‚ùå STRONG SELL - Significantly overvalued';
          color = '#ef4444';
        }
        
        document.getElementById('recommendation').textContent = recommendation;
        document.getElementById('recommendation').style.color = color;
        document.getElementById('comparisonSection').style.display = 'block';
      } else {
        document.getElementById('comparisonSection').style.display = 'none';
      }
      
      document.getElementById('result').style.display = 'block';
      document.getElementById('result').scrollIntoView({ behavior: 'smooth', block: 'nearest' });
    });
  </script>
</body>
</html>

